<html>
  <head>

    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous"> -->

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <style>
      @import "http://webfonts.ru/import/notcourier.css";
      html, body, .container-table {
          height: 100%;
          color: #fff;
      }
      input{
        display:none;
      }
      .overlay{
        position: fixed;
        width: 80%;
        height: 90%;
        top: 5%;
        left: 10%;
        background: rgba(0,0,0,0.6);
      }

      .overlay-container .menu-title {
        -webkit-transform: translateY(-50%);
        transform: translateY(-50%);
      }

      .overlay-container {
        text-align: center;
        position: relative;
        top: 50%;
        height: 60%;
        -webkit-transform: translateY(-50%);
        transform: translateY(-50%);
      }

      .overlay a, .overlay label, .overlay span {
        font-weight: 300;
        font-size: 1.5em;
        display: block;
        color: white;
        text-decoration:none;
        -webkit-transition: color 0.2s;
        transition: color 0.2s;
        font-family: 'NotCourierSans';
        text-transform:uppercase;
      }

      .overlay a:hover, nav a:hover {
        color: #849368;
        cursor: pointer;
      }

      .overlay .player-count-container {
        display: block;
      }

      .overlay .token-select-container {
        display: none;
      }

      .overlay #game-options-back, .overlay #game-options-start {
        display: none;
      }

      #op~.overlay-hugeinc{
        opacity: 0;
        visibility: hidden;
        -webkit-transition: opacity 0.5s;
        transition: opacity 0.5s;
      }

      #op:checked~.overlay-hugeinc{
        opacity: 1;
        visibility: visible;
        -webkit-transition: opacity 0.5s;
        transition: opacity 0.5s;
      }

      /*Hide the radio buttons*/
      [type='radio']{
          display: none;
      }
      /*Highlight text when selected. */
      [type='radio']:checked + label a{
        color: red;
      }
      .fullscreen-bg {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        overflow: hidden;
        z-index: -100;
      }
      .fullscreen-bg__video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
      @media (min-aspect-ratio: 16/9) {
        .fullscreen-bg__video {
          height: 300%;
          top: -100%;
        }
      }
      @media (max-aspect-ratio: 16/9) {
        .fullscreen-bg__video {
          width: 300%;
          left: -100%;
        }
      }
      @media (max-width: 767px) {
        .fullscreen-bg {
          background: url('') center center / cover no-repeat;
        }
      }
      .game-board {
        height: 400px;
        width: 400px;
      }
      .grid {
        height: 33%;
        line-height: 100%;
        vertical-align: middle;
        font-size: 40px;
        line-height: 130px;
        vertical-align: middle;
      }
      .grid-1, .grid-2, .grid-3, .grid-4, .grid-5, .grid-6 {
        border-bottom: #000 solid 1px;
      }
      .grid-1, .grid-2, .grid-4, .grid-5, .grid-7, .grid-8 {
        border-right: #000 solid 1px;
      }
    </style>
  </head>
  <body>
    <div class="fullscreen-bg">
      <video loop muted autoplay poster="" class="fullscreen-bg__video">
        <source src="http://video2.ignitemotion.com/files/mp4/Bubbles_Animation.mp4" type = "video/mp4">
      </video>
    </div>
    <div class="container container-table">
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand">Tic Tac Toe</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li><a class="btn-main-menu">Main Menu</a></li>
              <li><a class="btn-reset">New Game</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
      </nav>
      <div class="row">
        <div class="game-board text-center col-xs-4 col-xs-offset-4">
          <!-- first row -->
          <div class="grid grid-1 col-xs-4"></div><div class="grid grid-2 col-xs-4"></div><div class="grid grid-3 col-xs-4"></div>
          <!-- second row -->
          <div class="grid grid-4 col-xs-4"></div><div class="grid grid-5 col-xs-4"></div><div class="grid grid-6 col-xs-4"></div>
          <!-- third row -->
          <div class="grid grid-7 col-xs-4"></div><div class="grid grid-8 col-xs-4"></div><div class="grid grid-9 col-xs-4"></div>
        </div>
      </div>
      <div class="buttons">
        <h4 class="current-player-turn">Turn: <span></span></h4>
        <h5 class="player1"></h3>
        <h5 class="player2"></h3>
        <h2 class="winner-text"></h2>
      </div>
      <input type="checkbox" checked id="op"></input>
      <div class="overlay overlay-hugeinc">
        <div class="overlay-container">
          <div class="menu-title">
          <h1>Tic Tac Toe</h1>
          <h2>Menu</h2>
          </div>
          <div class="row player-count-container">
            <div class="col-xs-12"><h3>How many players?</h3></div>
            <div class="col-md-4 col-md-offset-1">
              <input type="radio" name="player-count" value="1" id="radio-one-player"/>
              <label for="radio-one-player"><a>One Player</a></label>
            </div>
            <div class="col-md-2"><span>&#9670;</span></div>
            <div class="col-md-4">
              <input type="radio" name="player-count" value="2" id="radio-two-player"/>
              <label for="radio-two-player"><a>Two Players</a></label>
            </div>
          </div>
          <div class="row token-select-container">
            <div class="col-xs-12"><h3>Which token do you want player 1 to be?</h3></div>
            <div class="col-md-3 col-md-offset-2">
              <input type="radio" name="token-select" value="x" id="radio-x"/>
              <label for="radio-x"><a>X</a></label>
            </div>
            <div class="col-md-2"><span>&#9670;</span></div>
            <div class="col-md-3">
              <input type="radio" name="token-select" value="o" id="radio-o"/>
              <label for="radio-o"><a>O</a></label>
            </div>
          </div>
          <div class="row game-options-container">
            <div class="col-xs-2 col-xs-offset-4">
              <a id="game-options-back">Back</a>
            </div>
            <div class="col-xs-2">
              <a id="game-options-start">Start</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script
    src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>

    <script 
    src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" 
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" 
    crossorigin="anonymous"></script>

    <!-- <script
    src="../Frameworks/Javascript/jQuery/jquery-3.1.1.min.js"></script> -->

    <script>
      $(document).ready(function() {
        var gameData = {};

        /* When a grid item on the game board is clicked, add the token for the current player
           and check to see if there is a winner */
        $('.grid').click(function() {
          if ($(this).html() === '' && !gameData.game.isGameOver()) {
            var nextPlayer = gameData.game.getNextPlayer();
            if (nextPlayer.constructor.name === "Player") {
              $(this).html(nextPlayer.token);
              setCurrentPlayer();
              gameData.game.checkGameOver();
            }
            if (gameData['player-count'] === 1) {
              ai(aiMove);
            }
          }
        });

        function ai(callback) {
          var nextPlayer = gameData.game.getNextPlayer();
          nextPlayer.updateBoard();
          callback(nextPlayer);
        }

        function aiMove(nextPlayer) {
          nextPlayer.updateMoves();
          setCurrentPlayer();
          gameData.game.checkGameOver();
        }

        /* New game: reset the game board */
        $('.btn-reset').click(function() {
          if (gameData.game.playerTwo.constructor.name !== "Player") {
            gameData.game.playerTwo.init();
          }
          gameData.game.resetGameBoard();
          setCurrentPlayer();
        });

        /* Reopen the main menu */
        $('.btn-main-menu').click(function() {
          $("#op").attr("checked", true);
        });

        /* The start game button has been clicked from the main menu
           Create the players and initialise the game */
        $('#game-options-start').click(function() {
          setNewPlayers();
          gameData.game.resetGameBoard();
          setCurrentPlayer();

          // reset main menu and then remove the overlay
          returnToFirstMainMenuScreen();
          $("#op").attr("checked", false);
        });

        /* The back button in the main menu has been pressed. Go back a screen */
        $("#game-options-back").click(function() {
          returnToFirstMainMenuScreen();
        });

        function setNewPlayers() {
          var playerOneToken = gameData['player-token'];
          var playerTwoToken = gameData['player-token'] === 'X' ? 'O' : 'X';

          player1 = new Player('Player One', playerOneToken);
          if (gameData['player-count'] === 1) {
            // one player
            player2 = new ComputerPlayer(playerTwoToken);
          } else {
            // two player
            player2 = new Player('Player Two', playerTwoToken);
          }
          game = new Game(player1, player2);
          gameData.game = game;
          
          $(".player1").html(player1.name + ': <span>' + player1.token + '</span>');
          $(".player2").html(player2.name + ': <span>' + player2.token + '</span>');
        }

        /* Helper function to go back to the start of the main menu */
        function returnToFirstMainMenuScreen() {
          $(".overlay .player-count-container").css("display", "block");
          $(".overlay .token-select-container").css("display", "none");
          $("#game-options-back, #game-options-start").css("display", "none");
        }

        /* Set the token for player 1 from the main menu */
        $( "input[name=token-select]:radio" ).click(function() {
          gameData["player-token"] = $( "input[name=token-select]:radio:checked" ).val().toUpperCase();
        });

        /* Set the game to be either 1 player or 2 players */
        $( "input[name=player-count]:radio").click(function() {
          var playerCount = Number($( "input[name=player-count]:radio:checked" ).val());
          gameData["player-count"] = playerCount;
          if (playerCount === 1) {
            $(".token-select-container h3").html("Which token do you want to be?")
          } else {
            $(".token-select-container h3").html("Which token do you want player 1 to be?")
          }
          $(".overlay .player-count-container").css("display", "none");
          $(".overlay .token-select-container").css("display", "block");
          $("#game-options-back, #game-options-start").css("display", "block");
        });

        /* Helper function to display the current player on the game board */
        function setCurrentPlayer() {
          $('.current-player-turn > span').html(gameData.game.currentPlayerTurn().name);
        }

        /* Game class: this class holds all the information for the current game */
        function Game(playerOne, playerTwo) {
          this.startingPlayer = playerOne;
          this.nextPlayer = undefined;
          this.currPlayer = this.startingPlayer;
          this.gameOver = false;
          this.movesTaken = 0;
          this.playerOne = playerOne;
          this.playerTwo = playerTwo;

          if (playerOne.token === playerTwo.token) {
            throw "Opposing players cannot have the same tokens.";
          }
        }

        Game.prototype = {
          getNextPlayer: function() {
            this.movesTaken++;
            if (this.nextPlayer === undefined) {
              this.nextPlayer = this.startingPlayer;
              this.startingPlayer = this.startingPlayer === this.playerOne ? this.playerTwo : this.playerOne;
            }
            this.currPlayer = this.nextPlayer;
            this.nextPlayer = this.nextPlayer === this.playerOne ? this.playerTwo : this.playerOne;
            return this.currPlayer;
          },
          resetGameBoard: function() {
            var gridPieces = $('.grid');
            this.nextPlayer = undefined;
            this.movesTaken = 0;
            this.currPlayer = this.startingPlayer;
            this.gameOver = false;
            gridPieces.html('');
            $('.winner-text').html('');
            if (this.currPlayer.constructor.name !== "Player") {
              ai(aiMove);
            }
          },
          currentPlayerTurn: function() {
            return this.nextPlayer || this.startingPlayer;
          },
          isGameOver: function() {
            return this.gameOver;
          },
          checkGameOver: function() {
            if (this.movesTaken < 5) {
              return;
            }
            // Row 1
            if ($('.grid-1').html() !== '' && $('.grid-1').html() === $('.grid-2').html() && $('.grid-1').html() === $('.grid-3').html()) {
              this.gameOver = true;
            }

            // Row 2
            if ($('.grid-4').html() !== '' && $('.grid-4').html() === $('.grid-5').html() && $('.grid-4').html() === $('.grid-6').html()) {
              this.gameOver = true;
            }

            // Row 3
            if ($('.grid-7').html() !== '' && $('.grid-7').html() === $('.grid-8').html() && $('.grid-7').html() === $('.grid-9').html()) {
              this.gameOver = true;
            }

            // Col 1
            if ($('.grid-1').html() !== '' && $('.grid-1').html() === $('.grid-4').html() && $('.grid-1').html() === $('.grid-7').html()) {
              this.gameOver = true;
            }

            // Col 2
            if ($('.grid-2').html() !== '' && $('.grid-2').html() === $('.grid-5').html() && $('.grid-2').html() === $('.grid-8').html()) {
              this.gameOver = true;
            }

            // Col 3
            if ($('.grid-3').html() !== '' && $('.grid-3').html() === $('.grid-6').html() && $('.grid-3').html() === $('.grid-9').html()) {
              this.gameOver = true;
            }

            // Diag 1
            if ($('.grid-1').html() !== '' && $('.grid-1').html() === $('.grid-5').html() && $('.grid-1').html() === $('.grid-9').html()) {
              this.gameOver = true;
            }

            // Diag 2
            if ($('.grid-3').html() !== '' && $('.grid-3').html() === $('.grid-5').html() && $('.grid-3').html() === $('.grid-7').html()) {
              this.gameOver = true;
            }
            if (this.gameOver) {
              $('.winner-text').html(this.currPlayer.name + ' wins!');
            }
            if ($('.winner-text').html() === '' &&
                $('.grid-1').html() !== '' &&
                $('.grid-2').html() !== '' &&
                $('.grid-3').html() !== '' &&
                $('.grid-4').html() !== '' &&
                $('.grid-5').html() !== '' &&
                $('.grid-6').html() !== '' &&
                $('.grid-7').html() !== '' &&
                $('.grid-8').html() !== '' &&
                $('.grid-9').html() !== '') {
              $('.winner-text').html('Draw!');
            }
          }
        };

        /* Player class: this class holds all the information for a human player */
        function Player(playerName, playerToken) {
          this.name = playerName;
          this.token = playerToken;

          if (playerToken !== 'X' && playerToken !== 'O') {
            throw "Player token must be X or O";
          }
        }

        /* ComputerPlayer class: extends the Player class with additional functions
           to control the AI */
        function ComputerPlayer(token) {
          Player.call(this, "Computer", token);
          this.board = {};
          this.winningCombos = {};
          this.losingCombos = {};
          this.init();
        }

        //ComputerPlayer.prototype = Player.prototype;
        ComputerPlayer.prototype = {
          init: function() {
            this.board = {
              1: undefined,
              2: undefined,
              3: undefined,
              4: undefined,
              5: undefined,
              6: undefined,
              7: undefined,
              8: undefined,
              9: undefined
            }
            this.winningCombos = [
              [1,2,3],
              [1,5,9],
              [1,4,7],
              [2,1,3],
              [2,3,1],
              [2,5,8],
              [3,2,1],
              [3,5,7],
              [3,6,9],
              [4,1,7],
              [4,5,6],
              [4,7,1],
              [5,1,9],
              [5,2,8],
              [5,3,7],
              [5,4,6],
              [5,6,4],
              [5,7,3],
              [5,8,2],
              [5,9,1],
              [6,3,9],
              [6,5,4],
              [6,9,3],
              [7,4,1],
              [7,5,8],
              [8,5,2],
              [8,7,9],
              [8,7,9],
              [8,9,7],
              [9,5,1],
              [9,6,3],
              [9,8,7]
            ];
            this.losingCombos = this.winningCombos;
          },
          updateBoard: function() {
            for (var key in this.board) {
              if (this.board.hasOwnProperty(key) && this.board.key === undefined) {
                if ($(".grid-" + key).html() !== "") {
                  this.board[key] = $(".grid-" + key).html();
                } // end if
              } // end if
            } // end for
          },
          updateMoves: function() {
            // Check if computer has any two in a row, and if so, go for the with with a three-in-a-row move
            for (var key in this.board) {
              if (this.board.hasOwnProperty(key) && this.board[key] !== undefined && this.board[key] !== this.token) {
                this.winningCombos = this.winningCombos.filter(this.filterCombos, key);
              } // end if
              if (this.board.hasOwnProperty(key) && this.board[key] !== undefined && this.board[key] === this.token) {
                this.losingCombos = this.losingCombos.filter(this.filterCombos, key);
              } // end if
            } // end for

            if (!this.checkWinningMoves()) {
              if (!this.checkLosingMoves()) {
                // Make a random move, get a random winning combo and then get a random value from inside that winning combo.
                if (this.winningCombos.length > 0) {
                  var arr = this.winningCombos[Math.floor(Math.random() * this.winningCombos.length)];
                  this.move(arr[Math.floor(Math.random() * arr.length)]);
                } else {
                  // There are no winning moves. Just go anywhere
                  for (var key in this.board) {
                    if (this.board[key] === undefined) {
                      this.move(key);
                      return;
                    }
                  }
                }
              }
            }
          }, // end checkMoves
          /* returns true if a move is made */
          checkWinningMoves: function() {
            // We don't have to worry about grid items having another player token in it here
            // because they have already been filtered out
            for (var i = 0; i < this.winningCombos.length; i++) {
              if (this.board[this.winningCombos[i][0]] === this.token) {
                if (this.board[this.winningCombos[i][1]] === this.token || this.board[this.winningCombos[i][2]] === this.token) {
                  //we have a winner because this.token is in 2 of the three winningCombo grids
                  if (this.board[this.winningCombos[i][1]] === undefined) {
                    // make the move into combo[2]
                    this.move(this.winningCombos[i][1]);
                    return true;
                  } else {
                    // make the move into combo[1]
                    this.move(this.winningCombos[i][2]);
                    return true;
                  }
                }
              } else if (this.board[this.winningCombos[i][1]] === this.token && this.board[this.winningCombos[i][2]] === this.token) {
                // Two of three means we also have a winner
                // Make the move into combo[0]
                this.move(this.winningCombos[i][0]);
                return true;
              }
            }
            return false;
          },
          checkLosingMoves: function() {
            // We don't have to worry about grid items having another player token in it here
            // because they have already been filtered out
            for (var i = 0; i < this.losingCombos.length; i++) {
              if (this.board[this.losingCombos[i][0]] !== undefined) {
                if (this.board[this.losingCombos[i][1]] !== undefined || this.board[this.losingCombos[i][2]] !== undefined) {
                  //we are about to lose because the other player has 2 of 3 of a winning row
                  if (this.board[this.losingCombos[i][1]] === undefined) {
                    // make the move into combo[1]
                    this.move(this.losingCombos[i][1]);
                    return true;
                  } else {
                    // make the move into combo[2]
                    this.move(this.losingCombos[i][2]);
                    return true;
                  }
                }
              } else if (this.board[this.losingCombos[i][1]] !== undefined && this.board[this.losingCombos[i][2]] !== undefined) {
                // Two of three means we about to lose. Save the game by taking combo[0]
                this.move(this.losingCombos[i][0]);
                return true;
              }
            }
            return false;
          },
          move: function(gridNumber) {
            if ($(".grid-" + gridNumber).html() !== "") {
              // A player has already placed a token here.
              throw new "Can't move here because another player has already placed a token in this square."
            }
            $(".grid-" + gridNumber).html(this.token);
          },
          filterCombos: function(value) {
            return !value.includes(Number(this[0]));
          }
          //ComputerPlayer.prototype.constructor = ComputerPlayer;   // Set constructor back to Robot
        }; // end ComputerPlayer.prototype
      });// end document ready 
    </script>
  </body>
</html>